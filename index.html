<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key System - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            backdrop-filter: blur(10px);
            background: rgba(17, 24, 39, 0.95);
        }
    </style>
</head>
<body class="p-4">
    <div id="app" class="max-w-6xl mx-auto">
        
        <!-- Tela de Login -->
        <div id="loginScreen" class="card rounded-lg p-8 max-w-md mx-auto mt-20 shadow-2xl border border-purple-500">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">ğŸ”</div>
                <h1 class="text-4xl font-bold text-purple-400 mb-2">Key System</h1>
                <p class="text-gray-400">Entre na sua conta</p>
            </div>
            
            <div id="errorMessage" class="hidden bg-red-500 bg-opacity-20 border border-red-500 text-red-400 px-4 py-3 rounded mb-4"></div>
            
            <div class="mb-4">
                <label class="text-gray-400 text-sm mb-2 block">Email</label>
                <input type="email" id="loginEmail" placeholder="seu@email.com" 
                    class="w-full bg-gray-800 border border-purple-500 rounded px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>

            <div class="mb-6">
                <label class="text-gray-400 text-sm mb-2 block">Senha</label>
                <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" 
                    class="w-full bg-gray-800 border border-purple-500 rounded px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>

            <button onclick="login()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded transition mb-4">
                Entrar
            </button>

            <div class="text-center">
                <button onclick="showRegister()" class="text-purple-400 hover:text-purple-300 text-sm">
                    NÃ£o tem conta? Cadastre-se
                </button>
            </div>
        </div>

        <!-- Tela de Registro -->
        <div id="registerScreen" class="hidden card rounded-lg p-8 max-w-md mx-auto mt-20 shadow-2xl border border-purple-500">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">ğŸ‘¤</div>
                <h1 class="text-4xl font-bold text-purple-400 mb-2">Criar Conta</h1>
                <p class="text-gray-400">Cadastre-se gratuitamente</p>
            </div>
            
            <div id="registerErrorMessage" class="hidden bg-red-500 bg-opacity-20 border border-red-500 text-red-400 px-4 py-3 rounded mb-4"></div>
            
            <div class="mb-4">
                <label class="text-gray-400 text-sm mb-2 block">Nome de UsuÃ¡rio</label>
                <input type="text" id="registerUsername" placeholder="Seu nome" 
                    class="w-full bg-gray-800 border border-purple-500 rounded px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>

            <div class="mb-4">
                <label class="text-gray-400 text-sm mb-2 block">Email</label>
                <input type="email" id="registerEmail" placeholder="seu@email.com" 
                    class="w-full bg-gray-800 border border-purple-500 rounded px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>

            <div class="mb-6">
                <label class="text-gray-400 text-sm mb-2 block">Senha</label>
                <input type="password" id="registerPassword" placeholder="MÃ­nimo 6 caracteres" 
                    class="w-full bg-gray-800 border border-purple-500 rounded px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>

            <button onclick="register()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded transition mb-4">
                Criar Conta
            </button>

            <div class="text-center">
                <button onclick="showLogin()" class="text-purple-400 hover:text-purple-300 text-sm">
                    JÃ¡ tem conta? FaÃ§a login
                </button>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden">
            <!-- Header -->
            <div class="card rounded-lg p-6 mb-6 shadow-xl border border-purple-500">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-3">
                        <div class="text-4xl">ğŸ”‘</div>
                        <div>
                            <h1 class="text-2xl font-bold text-white" id="welcomeMessage">OlÃ¡!</h1>
                            <p class="text-gray-400 text-sm" id="userEmail">email@example.com</p>
                        </div>
                    </div>
                    <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition">
                        ğŸšª Sair
                    </button>
                </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="card rounded-lg p-6 shadow-xl border border-purple-500">
                    <div class="text-gray-400 text-sm mb-2">Total de Keys</div>
                    <div class="text-3xl font-bold text-white" id="totalKeys">0</div>
                </div>
                <div class="card rounded-lg p-6 shadow-xl border border-green-500">
                    <div class="text-gray-400 text-sm mb-2">Keys Ativas</div>
                    <div class="text-3xl font-bold text-green-400" id="activeKeys">0</div>
                </div>
                <div class="card rounded-lg p-6 shadow-xl border border-red-500">
                    <div class="text-gray-400 text-sm mb-2">Keys Expiradas</div>
                    <div class="text-3xl font-bold text-red-400" id="expiredKeys">0</div>
                </div>
            </div>

            <!-- Create Key -->
            <div class="card rounded-lg p-6 mb-6 shadow-xl border border-purple-500">
                <h2 class="text-xl font-bold text-white mb-4">â• Criar Nova Key</h2>
                <div class="flex gap-4 flex-wrap">
                    <select id="keyDuration" class="bg-gray-800 border border-purple-500 rounded px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <option value="1">1 hora</option>
                        <option value="24" selected>24 horas</option>
                        <option value="168">7 dias</option>
                        <option value="720">30 dias</option>
                        <option value="8760">1 ano</option>
                    </select>
                    <button onclick="createKey()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded transition font-bold">
                        ğŸ”‘ Gerar Key
                    </button>
                </div>
                <div id="newKeyDisplay" class="mt-4 hidden">
                    <p class="text-gray-400 text-sm mb-2">âœ… Nova key criada:</p>
                    <div class="flex items-center gap-2 flex-wrap">
                        <code id="newKeyCode" class="bg-gray-800 text-purple-400 px-4 py-2 rounded flex-1 font-mono text-lg min-w-0 break-all"></code>
                        <button onclick="copyNewKey()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition whitespace-nowrap">
                            ğŸ“‹ Copiar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Keys List -->
            <div class="card rounded-lg p-6 shadow-xl border border-purple-500">
                <h2 class="text-xl font-bold text-white mb-4">ğŸ“‹ Minhas Keys</h2>
                <div id="keysList" class="space-y-3">
                    <p class="text-gray-400 text-center py-8">Carregando keys...</p>
                </div>
            </div>

            <!-- API Info -->
            <div class="card rounded-lg p-6 mt-6 shadow-xl border border-blue-500">
                <h2 class="text-xl font-bold text-white mb-4">ğŸ“¡ Use no Roblox</h2>
                <p class="text-gray-400 mb-2">Endpoint de validaÃ§Ã£o:</p>
                <code id="apiEndpoint" class="bg-gray-800 text-blue-400 px-4 py-2 rounded block font-mono text-sm break-all">
                    https://seu-projeto.vercel.app/api/keys/validate
                </code>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURE AQUI A URL DA SUA API
        const API_URL = window.location.origin + '/api';
        
        let currentUser = null;
        let userKeys = [];

        // Mostrar/Esconder telas
        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
        }

        function showError(message, screen = 'login') {
            const errorDiv = screen === 'login' ? 
                document.getElementById('errorMessage') : 
                document.getElementById('registerErrorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => errorDiv.classList.add('hidden'), 5000);
        }

        // Registro
        async function register() {
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            if (!username || !email || !password) {
                showError('Preencha todos os campos!', 'register');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });

                const data = await response.json();

                if (data.success) {
                    currentUser = data.data;
                    showDashboard();
                    loadDashboard();
                } else {
                    showError(data.message, 'register');
                }
            } catch (error) {
                showError('Erro ao conectar com servidor', 'register');
            }
        }

        // Login
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showError('Preencha email e senha!');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (data.success) {
                    currentUser = data.data;
                    showDashboard();
                    loadDashboard();
                } else {
                    showError(data.message);
                }
            } catch (error) {
                showError('Erro ao conectar com servidor');
            }
        }

        // Logout
        function logout() {
            currentUser = null;
            userKeys = [];
            showLogin();
        }

        // Carregar Dashboard
        function loadDashboard() {
            document.getElementById('welcomeMessage').textContent = `OlÃ¡, ${currentUser.username}!`;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('apiEndpoint').textContent = `${API_URL}/keys/validate`;
            loadKeys();
        }

        // Carregar Keys (simulado - vocÃª precisa criar endpoint /api/keys/list)
        function loadKeys() {
            // Por enquanto, vazio
            userKeys = [];
            updateStats();
            renderKeys();
        }

        // Criar Key
        async function createKey() {
            const duration = document.getElementById('keyDuration').value;

            try {
                const response = await fetch(`${API_URL}/keys/create`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': currentUser.token
                    },
                    body: JSON.stringify({ email: currentUser.email, duration })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('newKeyCode').textContent = data.data.key;
                    document.getElementById('newKeyDisplay').classList.remove('hidden');
                    userKeys.push(data.data);
                    updateStats();
                    renderKeys();
                } else {
                    alert('Erro ao criar key: ' + data.message);
                }
            } catch (error) {
                alert('Erro ao conectar com servidor');
            }
        }

        // Copiar nova key
        function copyNewKey() {
            const key = document.getElementById('newKeyCode').textContent;
            navigator.clipboard.writeText(key);
            alert('âœ… Key copiada!');
        }

        // Copiar key da lista
        function copyKey(key) {
            navigator.clipboard.writeText(key);
            alert('âœ… Key copiada!');
        }

        // Atualizar estatÃ­sticas
        function updateStats() {
            const now = Date.now();
            const active = userKeys.filter(k => k.expiresAt > now).length;
            const expired = userKeys.filter(k => k.expiresAt <= now).length;
            
            document.getElementById('totalKeys').textContent = userKeys.length;
            document.getElementById('activeKeys').textContent = active;
            document.getElementById('expiredKeys').textContent = expired;
        }

        // Renderizar lista de keys
        function renderKeys() {
            const container = document.getElementById('keysList');
            
            if (userKeys.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center py-8">VocÃª ainda nÃ£o tem keys. Crie sua primeira!</p>';
                return;
            }

            const now = Date.now();
            container.innerHTML = userKeys.map(keyData => {
                const isExpired = keyData.expiresAt <= now;
                const timeRemaining = getTimeRemaining(keyData.expiresAt);
                
                return `
                    <div class="bg-gray-800 border ${isExpired ? 'border-red-500 opacity-60' : 'border-purple-500'} rounded-lg p-4">
                        <div class="flex items-center justify-between flex-wrap gap-4">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-3 mb-2 flex-wrap">
                                    <code class="text-lg font-mono text-purple-400 font-bold break-all">${keyData.key}</code>
                                    ${isExpired ? '<span class="bg-red-600 text-white text-xs px-2 py-1 rounded whitespace-nowrap">EXPIRADA</span>' : ''}
                                </div>
                                <div class="flex items-center gap-4 text-sm text-gray-400 flex-wrap">
                                    <span>â° ${timeRemaining}</span>
                                    <span>ğŸ“… ${new Date(keyData.createdAt).toLocaleDateString('pt-BR')}</span>
                                    ${keyData.hwid ? '<span class="text-green-400">âœ“ Ativada</span>' : ''}
                                </div>
                            </div>
                            <button onclick="copyKey('${keyData.key}')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition whitespace-nowrap">
                                ğŸ“‹ Copiar
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Calcular tempo restante
        function getTimeRemaining(expiresAt) {
            const diff = expiresAt - Date.now();
            if (diff <= 0) return 'Expirada';
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days}d ${hours % 24}h`;
            return `${hours}h`;
        }

        // Enter para login
        document.getElementById('loginPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') login();
        });

        document.getElementById('registerPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') register();
        });
    </script>
</body>
</html>
